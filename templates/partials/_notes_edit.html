<form hx-post="{{ url_for('edit_notes', id=case.id) }}" 
      hx-target="#notes-wrapper-{{ case.id }}" 
      hx-swap="innerHTML"
      enctype="multipart/form-data">

    <div class="mb-2">
        <textarea name="notes" class="form-control form-control-sm" rows="3" placeholder="輸入備註...">{{ case.notes or '' }}</textarea>
    </div>

    <div class="mb-2">
        <label for="attachment-{{ case.id }}" class="form-label small">新增附件：</label>
        <input class="form-control form-control-sm" type="file" name="attachment" id="attachment-{{ case.id }}">
    </div>

    {% if case.attachments %}
    <div class="mb-2">
        <label class="form-label small">目前附件：</label>
        <ul class="list-group list-group-flush">
            {% for attachment in case.attachments %}
            <li class="list-group-item list-group-item-action d-flex justify-content-between align-items-center p-1">
                <a href="{{ url_for('download_attachment', filename=attachment.filepath) }}" class="text-decoration-none small" title="{{ attachment.filename }}">
                    <i class="bi bi-paperclip"></i> {{ attachment.filename|truncate(30) }}
                </a>
                <button type="button" class="btn btn-sm btn-outline-danger py-0 px-1"
                        hx-post="{{ url_for('delete_attachment', attachment_id=attachment.id) }}"
                        hx-target="#notes-wrapper-{{ case.id }}"
                        hx-swap="innerHTML"
                        hx-confirm="確定要刪除附件 '{{ attachment.filename }}' 嗎？">
                    <i class="bi bi-x-lg"></i>
                </button>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    <div class="d-flex justify-content-end gap-2">
        <button type="button" class="btn btn-sm btn-secondary" hx-get="{{ url_for('display_notes', id=case.id) }}" hx-target="#notes-wrapper-{{ case.id }}" hx-swap="innerHTML">取消</button>
        <button type="submit" class="btn btn-sm btn-primary">儲存</button>
    </div>
</form>